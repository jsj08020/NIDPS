<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>NIDPS ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10">

  <!-- ì œëª© -->
  <h1 class="text-4xl font-bold text-blue-600 mb-10">NIDPS ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h1>

  <!-- ì¹´ë“œ ì˜ì—­ -->
  <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-6 w-11/12 max-w-5xl mb-8">
    <div class="bg-white p-6 rounded-2xl shadow-md">
      <p class="text-gray-400">ì „ì²´ ë¡œê·¸ ìˆ˜</p>
      <p id="total" class="text-2xl font-semibold mt-2">-</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-md">
      <p class="text-gray-400">Ping íƒì§€</p>
      <p id="ping" class="text-2xl font-semibold mt-2 text-blue-500">-</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-md">
      <p class="text-gray-400">ë¹„ì •ìƒ ì ‘ê·¼</p>
      <p id="port" class="text-2xl font-semibold mt-2 text-red-500">-</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-md">
      <p class="text-gray-400">íŠ¸ë˜í”½ ê³¼ë‹¤</p>
      <p id="traffic" class="text-2xl font-semibold mt-2 text-orange-500">-</p>
    </div>
  </div>

  <!-- ë¡œê·¸ ë°•ìŠ¤ -->
  <div class="bg-white rounded-2xl shadow-md w-11/12 max-w-5xl p-6">
    <h2 class="text-xl font-semibold mb-4">ğŸ“œ ì‹¤ì‹œê°„ íƒì§€ ë¡œê·¸</h2>
    <div id="logBox" class="font-mono text-sm text-left h-96 overflow-y-auto border-t pt-3"></div>
  </div>

<script>
  let lastLogs = [];
  const logBox = document.getElementById("logBox");
  let autoScroll = true; // ê¸°ë³¸: ë§¨ ì•„ë˜ ìë™ ìŠ¤í¬ë¡¤ ì¼œì§

  // ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤í•  ë•Œ ìƒíƒœ ê°ì§€
  logBox.addEventListener("scroll", () => {
    // ğŸ”¹ ì •ë§ 'ë§¨ ì•„ë˜'ì— ìˆëŠ” ê²½ìš°ë§Œ true
    const tolerance = 1; // í”½ì…€ ì˜¤ì°¨ í—ˆìš© ë²”ìœ„
    autoScroll = Math.abs(logBox.scrollHeight - logBox.scrollTop - logBox.clientHeight) <= tolerance;
  });

  async function fetchLogs() {
    try {
      const res = await fetch("/api/logs");
      const data = await res.json();

      // ë¡œê·¸ê°€ ì™„ì „íˆ ë™ì¼í•˜ë©´ ê°±ì‹ í•˜ì§€ ì•ŠìŒ
      if (JSON.stringify(data) === JSON.stringify(lastLogs)) return;

      // ê¸°ì¡´ ë¡œê·¸ë³´ë‹¤ ê¸¸ë©´ ìƒˆ ë¡œê·¸ë§Œ ì¶”ê°€
      const newLogs = data.slice(lastLogs.length);
      newLogs.forEach(line => {
        const p = document.createElement("p");
        p.textContent = line;
        logBox.appendChild(p);
      });

      // ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ë¡œê·¸ ì œê±°
      if (logBox.children.length > 500) {
        for (let i = 0; i < 100; i++) {
          logBox.removeChild(logBox.firstChild);
        }
      }

      // ğŸ”¹ ì •ë§ ë§¨ ì•„ë˜ì— ìˆì„ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤
      if (autoScroll) {
        logBox.scrollTop = logBox.scrollHeight;
      }

      // í†µê³„ ì—…ë°ì´íŠ¸
      document.getElementById("total").textContent = data.length;
      document.getElementById("ping").textContent = data.filter(l => l.includes("Ping")).length;
      document.getElementById("port").textContent = data.filter(l => l.includes("Port")).length;
      document.getElementById("traffic").textContent = data.filter(l => l.includes("íŠ¸ë˜í”½")).length;

      // ìƒíƒœ ì—…ë°ì´íŠ¸
      lastLogs = data;

    } catch (err) {
      console.error("ì„œë²„ ì—°ê²° ì‹¤íŒ¨:", err);
    }
  }

  fetchLogs();
  setInterval(fetchLogs, 2000);
</script>




</body>
</html>
